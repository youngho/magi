/*
    *
    * Wijmo Library 5.20163.259
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
define(["require","exports",'wijmo/wijmo.xlsx','wijmo/wijmo','wijmo/wijmo.grid','wijmo/wijmo.grid.xlsx'],function(n,t,i,r,u,f){"use strict";function e(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.detail}function o(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.multirow}window.wijmo=window.wijmo||{};window.wijmo.grid=window.wijmo.grid||{};window.wijmo.grid.xlsx=f;'use strict';var s=function(){function n(){}return n.export=function(n,t){r._deprecated('FlexGridXlsxConverter.export','FlexGridXlsxConverter.save');var u=this.toWorkbookOM(n,t);return i.XlsxConverter.export(u)},n.import=function(n,t,u,f){r._deprecated('FlexGridXlsxConverter.import','FlexGridXlsxConverter.load');var e=i.XlsxConverter.import(n);this.fromWorkbookOM(e,t,u,f)},n.toWorkbookOM=function(n,t){r._deprecated('FlexGridXlsxConverter.toWorkbookOM','FlexGridXlsxConverter.save');var i={sheets:[],creator:'',created:new Date,lastModifiedBy:'',modified:new Date,activeWorksheet:0},u,f;if(t&&t.activeWorksheet!=null&&t.activeWorksheet>0&&(i.activeWorksheet=t.activeWorksheet),r.isArray(n))for(u=0;u<n.length;u++)f=n[u],this._exportFlexGrid(f,i,t);else this._exportFlexGrid(n,i,t);return i},n.fromWorkbookOM=function(n,t,f,e){r._deprecated('FlexGridXlsxConverter.fromWorkbookOM','FlexGridXlsxConverter.load');var fi=f?f.includeColumnHeader:!0,w=f?f.includeColumnHeader:!0,gt=1,nt=0,o=0,c=0,rt,ut,y,ft,k,b,et,wt,tt,ni,h,a,ti,d,ot,l,st,ht,ii,bt,v,ct,g,p,ri,lt,s,kt,dt,at,ui,it,vt=!1,yt={},pt;if(t.itemsSource=null,t.columns.clear(),t.rows.clear(),t.frozenColumns=0,t.frozenRows=0,n.sheets.length!==0)for(e&&(gt=n.sheets.length);nt<gt;nt++){for(kt={},dt={},c=0,ft=[],at=[],a=n.sheets[nt],fi&&(c=1,a.rows.length<=1&&(w=!1,c=0),wt=a.rows[0]),d=this._getColumnCount(a.rows),ti=this._getRowCount(a.rows,d),ii=a.summaryBelow,nt>0&&(ri=document.createElement('div'),t=new u.FlexGrid(ri)),y=a.columns||a.cols,o=0;o<d;o++)t.columns.push(new u.Column),!y[o]||(isNaN(+y[o].width)||(t.columns[o].width=+y[o].width),y[o].visible||y[o].visible==undefined||(t.columns[o].visible=!!y[o].visible),y[o].style&&!!y[o].style.wordWrap&&(t.columns[o].wordWrap=y[o].style.wordWrap));for(;c<ti;c++){if(ot=!1,pt=!0,h=a.rows[c],h)for(st=c+1;st<a.rows.length;)if(ht=a.rows[st],ht){(isNaN(h.groupLevel)&&!isNaN(ht.groupLevel)||!isNaN(h.groupLevel)&&h.groupLevel<ht.groupLevel)&&(ot=!0);break}else st++;for(ot&&!ii?(v&&(v.isCollapsed=vt),v=new u.GroupRow,v.isReadOnly=!1,vt=h.collapsed==null?!1:h.collapsed,v.level=isNaN(h.groupLevel)?0:h.groupLevel,yt[v.level]=vt,this._checkParentCollapsed(yt,v.level)&&v._setFlag(u.RowColFlags.ParentCollapsed,!0),t.rows.push(v)):(bt=new u.Row,h&&this._checkParentCollapsed(yt,h.groupLevel)&&bt._setFlag(u.RowColFlags.ParentCollapsed,!0),t.rows.push(bt)),!h||!h.height||isNaN(h.height)||(t.rows[w?c-1:c].height=h.height),o=0;o<d;o++)if(h){if(l=h.cells[o],p=l?l.formula:undefined,p&&p[0]!=='='&&(p='='+p),p=p?this._parseToFlexSheetFormula(p):undefined,t.setCellData(w?c-1:c,o,p&&e?p:this._getItemValue(l)),!ot&&l&&l.value!=null&&l.value!==''&&this._setColumn(ft,o,l),lt=c*d+o,s=l?l.style:undefined,s){if(pt=pt&&!!s.wordWrap,ui=this._getItemType(l),s.hAlign)it=i.Workbook._parseHAlignToString(r.asEnum(s.hAlign,i.HAlign));else switch(ui){case r.DataType.Number:it='right';break;case r.DataType.Boolean:it='center';break;default:it='left'}kt[lt]={fontWeight:s.font&&s.font.bold?'bold':'none',fontStyle:s.font&&s.font.italic?'italic':'none',textDecoration:s.font&&s.font.underline?'underline':'none',textAlign:it,fontFamily:s.font&&s.font.family?s.font.family:'',fontSize:s.font&&s.font.size?s.font.size+'px':'',color:s.font&&s.font.color?s.font.color:'',backgroundColor:s.fill&&s.fill.color?s.fill.color:'',format:i.Workbook._parseExcelFormat(l)};s.font&&at.indexOf(s.font.family)===-1&&at.push(s.font.family)}if(l&&r.isNumber(l.rowSpan)&&r.isNumber(l.colSpan))for(rt=c;rt<c+l.rowSpan;rt++)for(ut=o;ut<o+l.colSpan;ut++)lt=rt*d+ut,dt[lt]=new u.CellRange(c,o,c+l.rowSpan-1,o+l.colSpan-1)}else t.setCellData(w?c-1:c,o,''),this._setColumn(ft,o,undefined);h&&(this._checkParentCollapsed(yt,h.groupLevel)||h.visible||h.visible==undefined||(t.rows[w?c-1:c].visible=h.visible),t.rows[w?c-1:c].wordWrap=!!h.style&&!!h.style.wordWrap||pt)}for(v&&(v.isCollapsed=vt),a.frozenPane&&(ct=a.frozenPane.columns,r.isNumber(ct)&&!isNaN(ct)&&(t.frozenColumns=ct),g=a.frozenPane.rows,r.isNumber(g)&&!isNaN(g)&&(t.frozenRows=w&&g>0?g-1:g)),o=0;o<t.columnHeaders.columns.length;o++)k=ft[o],b=t.columns[o],b.isRequired=!1,w?(tt=wt?wt.cells[o]:undefined,tt&&tt.value?(ni=i.Workbook._parseExcelFormat(tt),et=r.Globalize.format(tt.value,ni)):et=this._numAlpha(o)):et=this._numAlpha(o),b.header=et,k&&(k.dataType===r.DataType.Boolean&&(b.dataType=k.dataType),b.format=k.format,b.align=k.hAlign,b.wordWrap=b.wordWrap||k.wordWrap);e&&(t.wj_sheetInfo={name:a.name,visible:a.visible!==!1,styledCells:kt,mergedRanges:dt,fonts:at});e&&nt>0&&e.push(t)}},n.save=function(n,t,i){var r=this._saveFlexGridToWorkbook(n,t);return i&&r.save(i),r},n.saveAsync=function(n,t,i,r,u){var f=this._saveFlexGridToWorkbook(n,t);return f.saveAsync(i,r,u),f},n.load=function(n,t,u){var f,e,o=this;if(t instanceof Blob)e=new FileReader,e.onload=function(){var t=i.Workbook._base64EncArr(new Uint8Array(e.result));f=new i.Workbook;f.load(t);o._loadToFlexGrid(n,f,u)},e.readAsArrayBuffer(t);else if(t instanceof i.Workbook)o._loadToFlexGrid(n,t,u);else{if(t instanceof ArrayBuffer)t=i.Workbook._base64EncArr(new Uint8Array(t));else if(!r.isString(t))throw'Invalid workbook.';f=new i.Workbook;f.load(t);o._loadToFlexGrid(n,f,u)}},n.loadAsync=function(n,t,u,f,e){var o,s,h=this;if(t instanceof Blob)s=new FileReader,s.onload=function(){var t=i.Workbook._base64EncArr(new Uint8Array(s.result));o=new i.Workbook;o.loadAsync(t,function(t){h._loadToFlexGrid(n,t,u);f&&f(t)},e)},s.readAsArrayBuffer(t);else if(t instanceof i.Workbook)h._loadToFlexGrid(n,t,u),f&&f(t);else{if(t instanceof ArrayBuffer)t=i.Workbook._base64EncArr(new Uint8Array(t));else if(!r.isString(t))throw'Invalid workbook.';o=new i.Workbook;o.loadAsync(t,function(t){h._loadToFlexGrid(n,t,u);f&&f(t)},e)}},n._exportFlexGrid=function(n,t,i){var d=[],s=[],o={columns:[],rows:[],summaryBelow:!1},tt=i?i.includeColumnHeaders!=null?i.includeColumnHeaders:i.includeColumnHeader!=null?i.includeColumnHeader:!0:!0,b=i?i.includeRowHeaders!=null?i.includeRowHeaders:!1:!1,w=i?i.includeCellStyles!=null?i.includeCellStyles:i.needGetCellStyle!=null?i.needGetCellStyle:!0:!0,a=i?i.includeColumns:null,h,v,c,f,e,p,y,g,it,k,nt=0,rt=0,l=0;if(p=n.wj_sheetInfo,o.name=p?p.name:'',o.visible=p?p.visible!==!1:!0,o.style={font:{size:14}},o.columns=[],!p&&w&&(y=document.createElement('div'),y.style.visibility='hidden',n.hostElement.appendChild(y)),b){for(f=0;f<n.rowHeaders.rows.length;f++)for(s[f]=[],o.columns[f]=[],e=0;e<n.rowHeaders.columns.length;e++)v=n._getBindingColumn(n.rowHeaders,f,n.rowHeaders.columns[e]),c=this._getColumnSetting(v,n.columnHeaders.columns.defaultSize),s[f][e]=c,o.columns[f][e]=c;l=e}if(tt&&n.columnHeaders.rows.length>0){for(f=0;f<n.columnHeaders.rows.length;f++){for(s[f]||(s[f]=[]),o.columns[f]||(o.columns[f]=[]),e=0;e<n.columnHeaders.columns.length;e++)v=n._getBindingColumn(n.rowHeaders,f,n.columnHeaders.columns[e]),c=this._getColumnSetting(v,n.columnHeaders.columns.defaultSize),s[f][l+e]=c,(!a||a(v))&&o.columns[f].push(c);l=0;h={};b&&(l=this._parseFlexGridRowToSheetRow(n.topLeftCells,h,f,0,s,w,y,!1,0,a));this._parseFlexGridRowToSheetRow(n.columnHeaders,h,f,l,s,w,y,!1,0,a);h.cells.length>0&&(d[f]=h)}rt=f}else for(s[0]||(s[0]=[]),o.columns[f]||(o.columns[f]=[]),e=0;e<n.columnHeaders.columns.length;e++)v=n.columnHeaders.columns[e],c=this._getColumnSetting(v,n.columnHeaders.columns.defaultSize),s[0][l+e]=c,(!a||a(v))&&o.columns[f].push(c);for(o.columns=s,f=0;f<n.cells.rows.length;f++)l=0,h={},g=n.rows[f],k=g instanceof u.GroupRow,k&&(it=r.tryCast(g,u.GroupRow),nt=it.level+1),b&&(l=this._parseFlexGridRowToSheetRow(n.rowHeaders,h,f,0,s,w,y,k,nt,a)),this._parseFlexGridRowToSheetRow(n.cells,h,f,l,s,w,y,k,nt,a),h.cells.length>0&&(d[rt+f]=h);o.rows=d;o.frozenPane={rows:tt?n.frozenRows+n.columnHeaders.rows.length:n.frozenRows,columns:b?n.frozenColumns+n.rowHeaders.columns.length:n.frozenColumns};t.sheets.push(o);!p&&w&&n.hostElement.removeChild(y)},n._saveFlexGridToWorkbook=function(n,t){var nt=new i.Workbook,c=new i.WorkSheet,tt=new i.WorkbookFrozenPane,ft=t&&t.includeColumnHeaders!=null?t.includeColumnHeaders:!0,g=t&&t.includeRowHeaders!=null?t.includeRowHeaders:!1,w=t&&t.includeCellStyles!=null?t.includeCellStyles:!0,st=t?t.activeWorksheet:null,l=t?t.includeColumns:null,o,v,b,y,p,s,f,e,it,a,d,et,k,rt=0,ut=0,ot=0,h=0;if(it=n.wj_sheetInfo,c.name=t?t.sheetName:'',c.visible=t?t.sheetVisible!==!1:!0,s=[],!it&&w&&(a=document.createElement('div'),a.style.visibility='hidden',n.hostElement.appendChild(a)),g){for(f=0;f<n.rowHeaders.rows.length;f++)for(s[f]=[],e=0;e<n.rowHeaders.columns.length;e++)b=n._getBindingColumn(n.rowHeaders,f,n.rowHeaders.columns[e]),y=this._getColumnSetting(b,n.columnHeaders.columns.defaultSize),s[f][e]=y,f===0&&(p=new i.WorkbookColumn,p._deserialize(y),c._addWorkbookColumn(p,e));h=e}if(ft&&n.columnHeaders.rows.length>0){for(f=0;f<n.columnHeaders.rows.length;f++){for(s[f]||(s[f]=[]),e=0;e<n.columnHeaders.columns.length;e++)b=n._getBindingColumn(n.columnHeaders,f,n.columnHeaders.columns[e]),y=this._getColumnSetting(b,n.columnHeaders.columns.defaultSize),s[f][h+e]=y,f===0&&(!l||l(b))&&(p=new i.WorkbookColumn,p._deserialize(y),c._addWorkbookColumn(p));h=0;o={};v=new i.WorkbookRow;g&&(h=this._parseFlexGridRowToSheetRow(n.topLeftCells,o,f,0,s,w,a,!1,0,l));this._parseFlexGridRowToSheetRow(n.columnHeaders,o,f,h,s,w,a,!1,0,l);o.cells.length>0&&(v._deserialize(o),c._addWorkbookRow(v,f))}ut=f}else for(s[0]||(s[0]=[]),e=0;e<n.columnHeaders.columns.length;e++)b=n._getBindingColumn(n.columnHeaders,0,n.columnHeaders.columns[e]),y=this._getColumnSetting(b,n.columnHeaders.columns.defaultSize),s[0][h+e]=y,(!l||l(b))&&(p=new i.WorkbookColumn,p._deserialize(y),c._addWorkbookColumn(p));for(f=0;f<n.cells.rows.length;f++)(h=0,o={},v=new i.WorkbookRow,d=n.rows[f],d instanceof u._NewRowTemplate)||(k=d instanceof u.GroupRow,k&&(et=r.tryCast(d,u.GroupRow),rt=et.level+1),g&&(h=this._parseFlexGridRowToSheetRow(n.rowHeaders,o,f,0,s,w,a,k,rt,l)),this._parseFlexGridRowToSheetRow(n.cells,o,f,h,s,w,a,k,rt,l),o.cells.length>0&&(v._deserialize(o),c._addWorkbookRow(v,ut+f)));for(ot=n.cells.rows.length,f=0;f<n.columnFooters.rows.length;f++)h=0,o={},v=new i.WorkbookRow,d=n.columnFooters.rows[f],k=d instanceof u.GroupRow,g&&(h=this._parseFlexGridRowToSheetRow(n.rowHeaders,o,f,0,s,w,a,k,0,l)),this._parseFlexGridRowToSheetRow(n.columnFooters,o,f,h,s,w,a,k,0,l),o.cells.length>0&&(v._deserialize(o),c._addWorkbookRow(v,ut+ot+f));return tt.rows=ft?n.frozenRows+n.columnHeaders.rows.length:n.frozenRows,tt.columns=g?n.frozenColumns+n.rowHeaders.columns.length:n.frozenColumns,c.frozenPane=tt,nt._addWorkSheet(c),!it&&w&&n.hostElement.removeChild(a),nt.activeWorksheet=st,nt},n._loadToFlexGrid=function(n,t,f){var ii=f&&f.includeColumnHeaders!=null?f.includeColumnHeaders:!0,p=f&&f.includeColumnHeaders!=null?f.includeColumnHeaders:!0,yt=f&&f.sheetIndex!=null&&!isNaN(f.sheetIndex)?f.sheetIndex:0,ri=f?f.sheetName:null,ui=f?f.sheetVisible:!0,fi=f&&(f.sheetIndex!=null&&!isNaN(f.sheetIndex)||f.sheetName!=null||f.sheetVisible!=null),e=0,h=0,tt,it,v,rt,b,w,ut,pt,g,dt,s,l,gt,k,ft,c,et,ot,ni,wt,a,st,d,y,ht,o,bt,kt,ct,ti,nt,lt=!1,at={},vt;if(n.itemsSource=null,n.columns.clear(),n.rows.clear(),n.frozenColumns=0,n.frozenRows=0,bt={},kt={},h=0,rt=[],ct=[],yt<0||yt>=t.sheets.length)throw'The sheet index option is out of the sheet range of current workbook.';if(l=t.sheets[yt],l.rows!=null){for(ii&&(h=1,l.rows.length<=1&&(p=!1,h=0),pt=l.rows[0]),k=this._getColumnCount(l.rows),gt=this._getRowCount(l.rows,k),ni=l.summaryBelow,v=l.columns||l.cols,e=0;e<k;e++)n.columns.push(new u.Column),!v[e]||(isNaN(+v[e].width)||(n.columns[e].width=+v[e].width),v[e].visible||v[e].visible==undefined||(n.columns[e].visible=!!v[e].visible),v[e].style&&!!v[e].style.wordWrap&&(n.columns[e].wordWrap=v[e].style.wordWrap));for(;h<gt;h++){if(ft=!1,vt=!0,s=l.rows[h],s)for(et=h+1;et<l.rows.length;)if(ot=l.rows[et],ot){(isNaN(s.groupLevel)&&!isNaN(ot.groupLevel)||!isNaN(s.groupLevel)&&s.groupLevel<ot.groupLevel)&&(ft=!0);break}else et++;for(ft&&!ni?(a&&(a.isCollapsed=lt),a=new u.GroupRow,a.isReadOnly=!1,lt=s.collapsed==null?!1:s.collapsed,a.level=isNaN(s.groupLevel)?0:s.groupLevel,at[a.level]=lt,this._checkParentCollapsed(at,a.level)&&a._setFlag(u.RowColFlags.ParentCollapsed,!0),n.rows.push(a)):(wt=new u.Row,s&&this._checkParentCollapsed(at,s.groupLevel)&&wt._setFlag(u.RowColFlags.ParentCollapsed,!0),n.rows.push(wt)),!s||!s.height||isNaN(s.height)||(n.rows[p?h-1:h].height=s.height),e=0;e<k;e++)if(s){if(c=s.cells[e],y=c?c.formula:undefined,y&&y[0]!=='='&&(y='='+y),y=y?this._parseToFlexSheetFormula(y):undefined,n.setCellData(p?h-1:h,e,y&&fi?y:this._getItemValue(c)),ft||this._setColumn(rt,e,c),ht=h*k+e,o=c?c.style:undefined,o){if(vt=vt&&!!o.wordWrap,ti=this._getItemType(c),o.hAlign)nt=i.Workbook._parseHAlignToString(r.asEnum(o.hAlign,i.HAlign));else switch(ti){case r.DataType.Number:nt='right';break;case r.DataType.Boolean:nt='center';break;default:nt='left'}bt[ht]={fontWeight:o.font&&o.font.bold?'bold':'none',fontStyle:o.font&&o.font.italic?'italic':'none',textDecoration:o.font&&o.font.underline?'underline':'none',textAlign:nt,fontFamily:o.font&&o.font.family?o.font.family:'',fontSize:o.font&&o.font.size?o.font.size+'px':'',color:o.font&&o.font.color?o.font.color:'',backgroundColor:o.fill&&o.fill.color?o.fill.color:'',format:i.Workbook._parseExcelFormat(c)};o.font&&ct.indexOf(o.font.family)===-1&&ct.push(o.font.family)}if(c&&r.isNumber(c.rowSpan)&&c.rowSpan>0&&r.isNumber(c.colSpan)&&c.colSpan>0&&(c.rowSpan>1||c.colSpan>1))for(tt=h;tt<h+c.rowSpan;tt++)for(it=e;it<e+c.colSpan;it++)ht=tt*k+it,kt[ht]=new u.CellRange(h,e,h+c.rowSpan-1,e+c.colSpan-1)}else n.setCellData(p?h-1:h,e,''),this._setColumn(rt,e,undefined);s&&(this._checkParentCollapsed(at,s.groupLevel)||s.visible||s.visible==undefined||(n.rows[p?h-1:h].visible=s.visible),n.rows[p?h-1:h].wordWrap=!!s.style&&!!s.style.wordWrap||vt)}for(a&&(a.isCollapsed=lt),l.frozenPane&&(st=l.frozenPane.columns,r.isNumber(st)&&!isNaN(st)&&(n.frozenColumns=st),d=l.frozenPane.rows,r.isNumber(d)&&!isNaN(d)&&(n.frozenRows=p&&d>0?d-1:d)),e=0;e<n.columnHeaders.columns.length;e++)b=rt[e],w=n.columns[e],w.isRequired=!1,p?(g=pt?pt.cells[e]:undefined,g&&g.value?(dt=i.Workbook._parseExcelFormat(g),ut=r.Globalize.format(g.value,dt)):ut=this._numAlpha(e)):ut=this._numAlpha(e),w.header=ut,b&&(b.dataType===r.DataType.Boolean&&(w.dataType=b.dataType),w.format=b.format,w.align=b.hAlign,w.wordWrap=w.wordWrap||b.wordWrap);n.wj_sheetInfo={name:ri||l.name,visible:ui===!0?!0:l.visible!==!1,styledCells:bt,mergedRanges:kt,fonts:ct}}},n._parseFlexGridRowToSheetRow=function(n,t,f,s,h,c,l,a,v,y){var nt,w,it,p,b,k,ft,st,et,rt,lt,g,tt,ht,ct,ot,d,vt=!1,at,ut,yt;for(nt=n.grid,ot=nt.wj_sheetInfo,w=n.rows[f],yt=w.recordIndex!=null?w.recordIndex:0,t.cells||(t.cells=[]),t.visible=w.isVisible,t.height=w.renderHeight||n.rows.defaultSize,t.groupLevel=a?v-1:v,a&&(t.collapsed=w.isCollapsed),w.wordWrap&&(t.style={wordWrap:w.wordWrap}),(w.constructor===u.Row||w.constructor===u._NewRowTemplate||e()&&w.constructor===e().DetailRow||o()&&w.constructor===o()._MultiRow)&&(vt=!0),p=0;p<n.columns.length;p++)if(ct=1,ht=1,ut=!1,at=nt._getBindingColumn(n,f,n.columns[p]),tt=null,ot&&n===nt.cells?(lt=f*n.columns.length+p,ot.mergedRanges&&(tt=ot.mergedRanges[lt]),ot.styledCells&&(g=ot.styledCells[lt])):c&&(g=this._getCellStyle(n,l,f,p)||{}),tt||(tt=nt.getMergedRange(n,f,p,!1)),tt?f===tt.topRow&&p===tt.leftCol&&(ht=tt.bottomRow-tt.topRow+1,ct=this._getColSpan(n,tt,y),ut=!0):ut=!0,!y||y(at))if(it=h[yt][p+s],vt||a?(k=ut?n.getCellData(f,p,!0):null,ft=ut?n.getCellData(f,p,!1):null,et=!1,k&&r.isString(k)&&k.length>1&&k[0]==='='&&(et=!0),d=r.isDate(ft),b=g&&g.format?i.Workbook._parseCellFormat(g.format,d):it&&it.style&&it.style.format?i.Workbook._parseCellFormat(it.style.format,d):null,b||(d?b='m/d/yyyy':r.isNumber(ft)&&!at.dataMap?b=r.isInt(ft)?'#,##0':'#,##0.00':et?(rt=k.toLowerCase(),rt==='=now()'?(b='m/d/yyyy h:mm',d=!0):rt==='=today()'||rt.substring(0,rt.indexOf('('))==='=date'?(b='m/d/yyyy',d=!0):rt.substring(0,rt.indexOf('('))==='=time'&&(b='h:mm AM/PM',d=!0)):b='General')):(k=ut?nt.columnHeaders.getCellData(0,p,!0):null,b='General'),n===nt.cells&&a&&w.hasChildren&&p===nt.columns.firstVisibleIndex){if(k?st=k:ut&&(st=w.getGroupHeader().replace(/<\/?\w+>/g,'')),st==null&&!g)continue;d=r.isDate(st);t.cells.push({value:st,isDate:d,formula:et?this._parseToExcelFormula(k,d):null,colSpan:ct,rowSpan:ht,style:this._extend(this._parseCellStyle(g),{format:b,font:{bold:!0},hAlign:i.HAlign.Left,indent:v-1})})}else t.cells.push({value:et?undefined:b==='General'?k:ft,isDate:d,formula:et?this._parseToExcelFormula(k,d):null,colSpan:p<nt.columns.firstVisibleIndex?1:ct,rowSpan:ht,style:this._extend(this._parseCellStyle(g),{format:b,hAlign:g&&g.textAlign?i.Workbook._parseStringToHAlign(g.textAlign):r.isDate(ft)&&it.style.hAlign==null?i.HAlign.Left:r.asEnum(it.style.hAlign,i.HAlign,!0),vAlign:ht>1?n===nt.cells?i.VAlign.Top:i.VAlign.Center:null})});return s+p},n._parseCellStyle=function(n){var t=n&&n.fontSize?+n.fontSize.substring(0,n.fontSize.indexOf('px')):null;return isNaN(t)&&(t=null),{font:{bold:n&&n.fontWeight&&(n.fontWeight==='bold'||!isNaN(+n.fontWeight)&&+n.fontWeight>=700),italic:n&&n.fontStyle&&n.fontStyle==='italic',underline:n&&n.textDecoration&&n.textDecoration==='underline',family:n?this._parseToExcelFontFamily(n.fontFamily):null,size:t,color:n&&n.color?n.color:null},fill:{color:n&&n.backgroundColor?n.backgroundColor:null},borders:n?this._parseBorder(n):null,hAlign:n&&n.textAlign?i.Workbook._parseStringToHAlign(n.textAlign):null}},n._parseBorder=function(n){var t,i;for(var r in{Left:0,Right:0,Top:0,Bottom:0})i=this._parseEgdeBorder(n,r),i&&(t||(t={}),t[r.toLowerCase()]=i);return t},n._parseEgdeBorder=function(n,t){var u,e='border'+t+'Color',f=n['border'+t+'Style'],o;if(f&&f!=='none'&&f!=='hidden'){u={};f=f.toLowerCase();switch(f){case'dotted':u.style=i.BorderStyle.Dotted;break;case'dashed':u.style=i.BorderStyle.Dashed;break;case'double':u.style=i.BorderStyle.Double;break;default:u.style=i.BorderStyle.Thin}n[e]&&(o=new r.Color(n[e]),u.color=o.toString())}return u},n._parseToExcelFontFamily=function(n){var t;return n&&(t=n.split(','),t&&t.length>0&&(n=t[0].replace(/\"|\'/g,''))),n},n._parseToExcelFormula=function(n,t){var u=n.substring(1,n.indexOf('(')).toLowerCase(),r;switch(u){case'ceiling':case'floor':n=n.substring(0,n.lastIndexOf(')'))+', 1)';break;case'text':r=n.substring(n.lastIndexOf(','),n.lastIndexOf('\"'));r=i.Workbook._parseCellFormat(r.substring(r.lastIndexOf('\"')+1),t);n=n.substring(0,n.lastIndexOf(',')+1)+'\"'+r+'\")'}return n},n._parseToFlexSheetFormula=function(n){var u=n.substring(1).match(/\W+(\w+)\(/),r,f,e,o,t;f=u&&u.length===2?u[1]:n.substring(1,n.indexOf('('));e=n.indexOf(f);switch(f.toLowerCase()){case'ceiling':case'floor':n=n.substring(0,n.lastIndexOf(','))+')';break;case'text':r=n.substring(e);t=r.substring(r.indexOf('\"'),r.lastIndexOf('\"'));t=t.substring(t.lastIndexOf('\"')+1);o=t.indexOf('0')>-1?0:'';t=i.Workbook._parseExcelFormat({value:o,style:{format:t}});t=t.replace(/m+/g,function(n){return n.toUpperCase()}).replace(/Y+/g,function(n){return n.toLowerCase()}).replace(/M+:?|:?M+/gi,function(n){return n.indexOf(':')>-1?n.toLowerCase():n});n=n.substring(0,e)+r.substring(0,r.indexOf('\"')+1)+t+'\")'}return n},n._getColumnSetting=function(n,t){var u=n.renderWidth;return u=u||t,{autoWidth:!0,width:u,visible:n.visible,style:{format:n.format?i.Workbook._parseCellFormat(n.format,n.dataType===r.DataType.Date):'',hAlign:i.Workbook._parseStringToHAlign(this._toExcelHAlign(n.getAlignment())),wordWrap:n.wordWrap}}},n._toExcelHAlign=function(n){return(n=n?n.trim().toLowerCase():n,!n)?n:n.indexOf('center')>-1?'center':n.indexOf('right')>-1||n.indexOf('end')>-1?'right':n.indexOf('justify')>-1?'justify':'left'},n._getColumnCount=function(n){for(var f=0,t=0,i,u=0;u<n.length;u++)i=n[u]&&n[u].cells?n[u].cells:[],i&&i.length>0&&(t=i.length,r.isInt(i[t-1].colSpan)&&i[t-1].colSpan>1&&(t=t+i[t-1].colSpan-1),t>f&&(f=t));return f},n._getRowCount=function(n,t){for(var f=n.length,u=f-1,o=0,e,s,i;o<t;o++)n:for(;u>=0;u--)if(e=n[u],s=e&&e.cells?e.cells:[],i=s[o],i&&(i.value!=null&&i.value!==''||r.isInt(i.rowSpan)&&i.rowSpan>1)){r.isInt(i.rowSpan)&&i.rowSpan>1&&u+i.rowSpan>f&&(f=u+i.rowSpan);break n}return f},n._numAlpha=function(n){var t=Math.floor(n/26)-1;return(t>-1?this._numAlpha(t):'')+String.fromCharCode(65+n%26)},n._getItemType=function(n){return n===undefined||n===null||n.value===undefined||n.value===null||isNaN(n.value)?undefined:r.getType(n.value)},n._setColumn=function(n,t,u){var e,o,s,f=n[t];f?(e=this._getItemType(u),f.dataType!==e&&f.dataType===r.DataType.Boolean&&e!==r.DataType.Boolean&&(f.dataType=e),u&&u.value!=null&&u.value!==''&&(o=i.Workbook._parseExcelFormat(u),o&&f.format!==o&&o!=='General'&&(f.format=o)),u&&u.style&&(u.style.hAlign&&(s=i.Workbook._parseHAlignToString(r.asEnum(u.style.hAlign,i.HAlign))),f.wordWrap=f.wordWrap&&!!u.style.wordWrap),s||e!==r.DataType.Number||(s='right'),f.hAlign=s):n[t]={dataType:this._getItemType(u),format:i.Workbook._parseExcelFormat(u),hAlign:'',wordWrap:!0}},n._getItemValue=function(n){if(n===undefined||n===null||n.value===undefined||n.value===null)return undefined;var t=n.value;return r.isNumber(t)&&isNaN(t)?'':t instanceof Date&&isNaN(t.getTime())?'':t},n._getCellStyle=function(n,t,i,r){try{this._resetCellStyle(t);n.grid.cellFactory.updateCell(n,i,r,t)}catch(u){return undefined}return window.getComputedStyle(t)},n._resetCellStyle=function(n){for(var t in n.style)typeof n.style[t]=='string'&&isNaN(+t)&&(n.style[t]='')},n._extend=function(n,t){var i,u;for(i in t)u=t[i],r.isObject(u)&&n[i]?r.copy(n[i],u):n[i]=u;return n},n._checkParentCollapsed=function(n,t){var i=!1;return Object.keys(n).forEach(function(r){n[r]===!0&&i===!1&&!isNaN(t)&&+r<t&&(i=!0)}),i},n._getColSpan=function(n,t,i){for(var u=0,r=t.leftCol;r<=t.rightCol;r++)(!i||i(n.columns[r]))&&u++;return u},n}();t.FlexGridXlsxConverter=s})