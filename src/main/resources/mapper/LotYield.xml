<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.famos.bets.yieldAnalysis.lotYield.mapper.LotYieldMapper">
    <select id="retrieveLotYield" parameterType="kr.famos.bets.yieldAnalysis.lotYield.dto.LotYieldDto" resultType="kr.famos.bets.yieldAnalysis.lotYield.dto.LotYieldDto">
    SELECT
          PART_NUMBER,
          OPERATOR_ID,
          LOT_ID,
          LOT_IN_TIME,
          END_TIME,
          PROCESS_CODE,
          TESTER_NUMBER,
          TESTER_MODEL,
          HEAD,
          TEST_COUNTER,
          HANDLER_MODEL,
          BOARD_ID,
          MAIN_PROGRAM_NAME,
          SBL_RESULT,
          SBL_YIELD_RESULT,
          SBL_BIN1_RESULT,
          SBL_BIN2_RESULT,
          SBL_BIN3_RESULT,
          SBL_BIN4_RESULT,
          SBL_BIN5_RESULT,
          SBL_BIN6_RESULT,
          SBL_BIN7_RESULT,
          SBL_BIN8_RESULT,
          SBL_BIN9_RESULT,
          QUANTITY,
          TO_NUMBER(SUBSTR(OP_BIN,1,4)) + TO_NUMBER( SUBSTR(OP_BIN,6,4)) + TO_NUMBER(SUBSTR(OP_BIN,11,4)) + TO_NUMBER(SUBSTR(OP_BIN,16,4))+ TO_NUMBER(SUBSTR(OP_BIN,21,4))+ TO_NUMBER(SUBSTR(OP_BIN,26,4))+ TO_NUMBER(SUBSTR(OP_BIN,31,4))+ TO_NUMBER( SUBSTR(OP_BIN,36,4)) AS INPUT ,
          TO_NUMBER(SUBSTR(OP_BIN,1,4)) + TO_NUMBER( SUBSTR(OP_BIN,6,4)) + TO_NUMBER(SUBSTR(OP_BIN,11,4)) + TO_NUMBER(SUBSTR(OP_BIN,16,4)) AS PASS,
          TRUNC(((TO_NUMBER(SUBSTR(OP_BIN,1,4)) + TO_NUMBER( SUBSTR(OP_BIN,6,4)) + TO_NUMBER(SUBSTR(OP_BIN,11,4)) + TO_NUMBER(SUBSTR(OP_BIN,16,4))) / (TO_NUMBER(SUBSTR(OP_BIN,1,4)) + TO_NUMBER( SUBSTR(OP_BIN,6,4)) + TO_NUMBER(SUBSTR(OP_BIN,11,4)) + TO_NUMBER(SUBSTR(OP_BIN,16,4))+ TO_NUMBER(SUBSTR(OP_BIN,21,4))+ TO_NUMBER(SUBSTR(OP_BIN,26,4))+ TO_NUMBER(SUBSTR(OP_BIN,31,4))+ TO_NUMBER( SUBSTR(OP_BIN,36,4))))*100,2) AS YIELD,
          TO_NUMBER(SUBSTR(OP_BIN,1,4))                                                                                                                                                                                                                                                                                                                                                                                                                 AS BIN1,
          TO_NUMBER(SUBSTR(OP_BIN,6,4))                                                                                                                                                                                                                                                                                                                                                                                                                 AS BIN2,
          TO_NUMBER(SUBSTR(OP_BIN,11,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN3,
          TO_NUMBER(SUBSTR(OP_BIN,16,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN4,
          TO_NUMBER(SUBSTR(OP_BIN,21,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN5,
          TO_NUMBER(SUBSTR(OP_BIN,26,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN6,
          TO_NUMBER(SUBSTR(OP_BIN,31,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN7,
          TO_NUMBER(SUBSTR(OP_BIN,36,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN8,
          TO_NUMBER(SUBSTR(OP_BIN,41,4))                                                                                                                                                                                                                                                                                                                                                                                                                AS BIN9
    FROM
          MAIN_BIN
          <where>
                1 = 1
                <if test=" endTimeStart != null and endTimeStart != '' ">
                AND END_TIME >= #{endTimeStart}
                </if>
                <if test=" endTimeEnd != null and endTimeEnd != '' ">
                AND END_TIME <![CDATA[<=]]> #{endTimeEnd}
                </if>
                <if test=" partNumber != null and partNumber != '' ">
                      AND PART_NUMBER=#{partNumber}
                </if>
                <if test=" processCode != null and processCode != '' ">
                      AND PROCESS_CODE=#{processCode}
                </if>
                <if test=" testerModel != null and testerModel != '' ">
                      AND TESTER_MODEL=#{testerModel}
                </if>
                <if test=" testerNumber != null and testerNumber != '' ">
                      AND TESTER_NUMBER=#{testerNumber}
                </if>
                <if test=" head != null and head != '' ">
                      AND HEAD=#{head}
                </if>
                <if test=" testCounter != null and testCounter != '' ">
                      AND TEST_COUNTER=#{testCounter}
                </if>
                <if test=" lotId != null and lotId != '' ">
                      AND LOT_ID=#{lotId}
                </if>
                <if test=" mainProgramName != null and mainProgramName != '' ">
                      AND MAIN_PROGRAM_NAME=#{mainProgramName}
                </if>
                <if test=" boardId != null and boardId != '' ">
                      AND BOARD_ID=#{boardId}
                </if>
          </where>
    </select>
</mapper>
